---
id: SPEC-VOICE-001
version: "1.0.0"
status: "draft"
created: "2026-01-08"
updated: "2026-01-08"
author: "지니"
priority: "HIGH"
---

## HISTORY

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2026-01-08 | 지니 | 초안 작성 |

---

# SPEC-VOICE-001: 음성 녹취 기반 증거 분석 시스템

## 1. 개요

### 1.1 목적

음성 녹취 파일을 텍스트로 변환하고, 법적 증거로 활용 가능한 형태로 분석하는 통합 시스템을 구축한다. 협박, 공갈, 사기, 모욕 등 범죄 발언을 자동으로 태깅하고, 가스라이팅과 같은 심리적 조작 패턴을 감지하여 체계적인 증거 보고서를 생성한다.

### 1.2 범위

- 음성-텍스트 변환 (STT)
- 화자 분리 (Speaker Diarization)
- 원본 보존 및 교정/교열 분리 시스템
- 범죄 발언 자동 태깅
- 심리 분석 (가스라이팅, 감정 분석)
- 법적 증거 보고서 생성

---

## 2. 환경 (Environment)

### 2.1 기술 스택

- **STT Engine**: OpenAI Whisper large-v3
- **화자 분리**: pyannote-audio 3.1+
- **오디오 처리**: FFmpeg 6.0+
- **백엔드 프레임워크**: FastAPI 0.115+
- **LLM 분석**: LangChain 0.3+ with Claude API
- **데이터베이스**: SQLite (개발) / PostgreSQL 16+ (운영)
- **파일 스토리지**: 로컬 파일 시스템 (원본 보존)

### 2.2 시스템 요구사항

- Python 3.11+
- CUDA 지원 GPU (권장: NVIDIA RTX 3080+)
- 최소 16GB RAM
- 최소 100GB SSD 저장 공간

---

## 3. 가정 (Assumptions)

### 3.1 기술적 가정

- 사용자는 한국어 또는 영어 음성 파일을 제공한다
- 녹취 품질이 STT 인식 가능 수준이다 (SNR > 15dB)
- 음성 파일은 일반적인 포맷으로 제공된다 (mp3, wav, m4a, flac)

### 3.2 비즈니스 가정

- 사용자는 녹취에 대한 합법적 권한을 보유한다
- 분석 결과는 참고 자료이며, 법적 효력은 별도 검토가 필요하다
- 원본 파일의 무결성이 법적 증거력의 핵심이다

---

## 4. 요구사항 (Requirements)

### 4.1 Ubiquitous (시스템 전역 요구사항)

**U1**: 시스템은 **항상** 모든 사용자 요청에 대해 감사 로그를 기록해야 한다
WHY: 법적 증거 시스템에서 모든 접근과 변경 이력은 추적 가능해야 한다
IMPACT: 감사 로그 미비는 증거 무결성 훼손으로 이어질 수 있다

**U2**: 시스템은 **항상** 원본 파일을 불변(immutable) 상태로 보존해야 한다
WHY: 원본 훼손 시 법적 증거 능력이 상실된다
IMPACT: 원본 변조 가능성은 전체 분석 결과의 신뢰성을 무효화한다

**U3**: 시스템은 **항상** 모든 API 응답에 처리 상태 코드와 메시지를 포함해야 한다
WHY: 클라이언트가 처리 결과를 명확히 파악할 수 있어야 한다
IMPACT: 불명확한 응답은 사용자 혼란과 오류 처리 실패를 유발한다

**U4**: 시스템은 **항상** 민감 데이터를 암호화하여 저장해야 한다
WHY: 녹취 파일과 분석 결과는 개인정보보호법 적용 대상이다
IMPACT: 암호화 미비는 법적 제재와 신뢰 상실을 초래한다

### 4.2 Event-Driven (이벤트 기반 요구사항)

**E1**: **WHEN** 음성 파일이 업로드되면 **THEN** 시스템은 파일 무결성 해시(SHA-256)를 생성하고 저장해야 한다
WHY: 업로드 시점의 파일 상태를 증명할 수 있어야 한다
IMPACT: 해시 미생성 시 원본 검증이 불가능해진다

**E2**: **WHEN** STT 변환이 완료되면 **THEN** 시스템은 원본 텍스트를 "원본" 버전으로 저장하고 별도의 "교정본" 버전을 생성해야 한다
WHY: 원본과 교정본의 분리는 증거 신뢰성의 핵심이다
IMPACT: 혼합 저장 시 원본 텍스트의 법적 가치가 훼손된다

**E3**: **WHEN** 범죄 키워드가 감지되면 **THEN** 시스템은 해당 발언에 범죄 유형 태그를 자동으로 부착해야 한다
WHY: 법률 전문가의 검토 효율성을 높여야 한다
IMPACT: 자동 태깅 미비 시 중요 증거를 놓칠 수 있다

**E4**: **WHEN** 가스라이팅 패턴이 감지되면 **THEN** 시스템은 관련 발언들을 그룹화하고 패턴 분석 결과를 첨부해야 한다
WHY: 심리적 조작은 단일 발언이 아닌 패턴으로 판단해야 한다
IMPACT: 개별 분석은 심리적 조작의 전체 맥락을 놓칠 수 있다

**E5**: **WHEN** 보고서 생성이 요청되면 **THEN** 시스템은 모든 분석 결과를 통합한 PDF 보고서를 생성해야 한다
WHY: 법적 제출용 문서는 표준화된 형식이어야 한다
IMPACT: 비표준 형식은 법적 채택 가능성을 낮춘다

### 4.3 State-Driven (상태 기반 요구사항)

**S1**: **IF** 파일 처리 상태가 "분석 중"이면 **THEN** 동일 파일에 대한 추가 분석 요청은 대기열에 추가되어야 한다
WHY: 동시 처리는 결과 일관성을 해칠 수 있다
IMPACT: 중복 처리는 리소스 낭비와 데이터 충돌을 유발한다

**S2**: **IF** 시스템이 "유지보수 모드"이면 **THEN** 읽기 전용 접근만 허용되어야 한다
WHY: 유지보수 중 데이터 변경은 무결성을 위협한다
IMPACT: 유지보수 중 변경은 예측 불가능한 오류를 유발할 수 있다

**S3**: **IF** 저장 공간이 임계치(90%) 이상이면 **THEN** 관리자에게 경고를 발송하고 새 파일 업로드를 제한해야 한다
WHY: 저장 공간 부족은 데이터 손실로 이어질 수 있다
IMPACT: 무제한 업로드는 시스템 장애를 유발한다

**S4**: **IF** 화자가 2인 이상으로 식별되면 **THEN** 각 화자별로 발언을 분리하여 타임스탬프와 함께 저장해야 한다
WHY: 법적 분석에서 발언자 특정은 핵심 요소이다
IMPACT: 화자 미분리 시 책임 소재 파악이 불가능하다

### 4.4 Feature (기능 요구사항)

**F1**: 시스템은 mp3, wav, m4a, flac, ogg 형식의 음성 파일을 지원해야 한다
WHY: 다양한 녹음 기기와의 호환성을 보장해야 한다
IMPACT: 제한된 형식 지원은 사용자 접근성을 낮춘다

**F2**: 시스템은 Whisper large-v3 모델을 사용하여 한국어/영어 음성을 텍스트로 변환해야 한다
WHY: 높은 정확도의 STT가 분석 품질의 기반이다
IMPACT: 낮은 STT 정확도는 전체 분석의 신뢰성을 훼손한다

**F3**: 시스템은 pyannote-audio를 사용하여 화자를 자동으로 분리하고 레이블링해야 한다
WHY: 대화 참여자 구분은 법적 분석의 전제 조건이다
IMPACT: 화자 혼동은 증거 가치를 심각하게 훼손한다

**F4**: 시스템은 협박, 공갈, 사기, 모욕 유형의 범죄 발언을 자동으로 태깅해야 한다
WHY: 법률 검토 효율성을 극대화해야 한다
IMPACT: 수동 검토만으로는 대량 증거 처리가 불가능하다

**F5**: 시스템은 가스라이팅 패턴(부정, 전가, 축소, 혼란 유발 등)을 감지해야 한다
WHY: 심리적 조작은 범죄 구성요건에 해당할 수 있다
IMPACT: 심리 패턴 미감지 시 중요 증거를 놓칠 수 있다

**F6**: 시스템은 발언별 감정 분석 결과(분노, 공포, 슬픔 등)를 제공해야 한다
WHY: 감정 상태는 피해 정도를 입증하는 보조 자료이다
IMPACT: 감정 분석 부재 시 피해 심각성 입증이 어렵다

**F7**: 시스템은 분석 결과를 PDF 형식의 증거 보고서로 출력해야 한다
WHY: 법적 제출용 표준 형식이 필요하다
IMPACT: 비표준 출력은 법적 채택 가능성을 낮춘다

### 4.5 Optional (선택적 요구사항)

**O1**: **가능하면** 실시간 스트리밍 STT를 제공하여 녹취 중 실시간 분석을 지원할 수 있다
WHY: 실시간 분석은 사용자 경험을 향상시킨다
IMPACT: 미구현 시 배치 처리만 가능하나 핵심 기능에 영향 없음

**O2**: **가능하면** 다국어 지원을 확장하여 일본어, 중국어 음성도 처리할 수 있다
WHY: 글로벌 사용자 확대 가능성이 있다
IMPACT: 미구현 시 한국어/영어 사용자에게만 서비스 제공

**O3**: **가능하면** 음성 감정 분석(Voice Emotion Recognition)을 통해 텍스트 외 음성 특성 기반 분석을 제공할 수 있다
WHY: 텍스트만으로 파악하기 어려운 감정을 포착할 수 있다
IMPACT: 미구현 시 텍스트 기반 감정 분석으로 대체

### 4.6 Unwanted (금지 요구사항)

**N1**: 시스템은 원본 음성 파일을 **수정하거나 삭제하지 않아야 한다**
WHY: 원본 보존은 법적 증거력의 핵심이다
IMPACT: 원본 변조 시 모든 분석 결과의 법적 가치가 상실된다

**N2**: 시스템은 사용자 인증 없이 분석 결과에 **접근을 허용하지 않아야 한다**
WHY: 민감 정보 보호는 법적 의무이다
IMPACT: 무단 접근은 개인정보보호법 위반이다

**N3**: 시스템은 암호화되지 않은 채널로 민감 데이터를 **전송하지 않아야 한다**
WHY: 전송 중 데이터 노출은 보안 위협이다
IMPACT: 평문 전송은 도청 및 변조 위험을 초래한다

---

## 5. 명세 (Specifications)

### 5.1 API 엔드포인트

| 엔드포인트 | 메서드 | 설명 |
|------------|--------|------|
| `/api/v1/audio/upload` | POST | 음성 파일 업로드 및 해시 생성 |
| `/api/v1/audio/{id}/transcribe` | POST | STT 변환 시작 |
| `/api/v1/audio/{id}/transcript` | GET | 변환 결과 조회 (원본/교정본) |
| `/api/v1/audio/{id}/speakers` | GET | 화자 분리 결과 조회 |
| `/api/v1/audio/{id}/analysis/crime` | GET | 범죄 발언 태깅 결과 조회 |
| `/api/v1/audio/{id}/analysis/psychology` | GET | 심리 분석 결과 조회 |
| `/api/v1/audio/{id}/report` | POST | 증거 보고서 생성 |
| `/api/v1/audio/{id}/report` | GET | 증거 보고서 다운로드 |

### 5.2 데이터 모델

```python
class AudioFile:
    id: UUID
    original_filename: str
    file_hash: str  # SHA-256
    file_path: str
    duration_seconds: float
    upload_timestamp: datetime
    status: ProcessingStatus

class Transcript:
    id: UUID
    audio_id: UUID
    version: str  # "original" | "corrected"
    content: str
    segments: list[TranscriptSegment]
    created_at: datetime

class TranscriptSegment:
    id: UUID
    transcript_id: UUID
    speaker_id: str
    start_time: float
    end_time: float
    text: str
    confidence: float
    crime_tags: list[CrimeTag]
    emotion: EmotionAnalysis

class CrimeTag:
    type: str  # "협박" | "공갈" | "사기" | "모욕"
    confidence: float
    keywords: list[str]
    legal_reference: str

class PsychologyAnalysis:
    id: UUID
    audio_id: UUID
    gaslighting_patterns: list[GaslightingPattern]
    emotion_summary: dict[str, float]
    risk_assessment: str
```

### 5.3 범죄 유형 정의

| 유형 | 키워드 예시 | 법적 참조 |
|------|-------------|-----------|
| 협박 | "죽여버린다", "가만 안 둔다", "불질러버린다" | 형법 제283조 |
| 공갈 | "돈 안 주면", "까불면 알지", "퍼뜨려버린다" | 형법 제350조 |
| 사기 | "무조건 된다", "손해 없다", "내가 보장한다" | 형법 제347조 |
| 모욕 | 비속어, 인격 비하 표현 | 형법 제311조 |

### 5.4 가스라이팅 패턴 정의

| 패턴 | 설명 | 탐지 기준 |
|------|------|-----------|
| 부정 (Denial) | 상대방의 경험/기억을 부정 | "그런 적 없다", "네가 잘못 기억하는 거다" |
| 전가 (Blame-shifting) | 책임을 상대방에게 전가 | "네 때문에", "네가 그렇게 해서" |
| 축소 (Minimizing) | 상대방의 감정/경험을 축소 | "별거 아닌데", "과민반응이다" |
| 혼란 유발 (Confusion) | 의도적으로 혼란을 주는 발언 | 모순된 진술, 갑작스러운 주제 전환 |

---

## 6. 추적성 (Traceability)

### 6.1 관련 문서

- `plan.md`: 구현 계획 및 마일스톤
- `acceptance.md`: 인수 조건 및 테스트 시나리오

### 6.2 태그

```
[SPEC-VOICE-001]
[STT] [화자분리] [범죄분석] [심리분석] [증거보고서]
```

---

## 7. 변경 이력

| 날짜 | 버전 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 2026-01-08 | 1.0.0 | 지니 | 초안 작성 |
