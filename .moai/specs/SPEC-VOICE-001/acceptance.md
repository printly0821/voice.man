---
id: SPEC-VOICE-001
document: acceptance
version: "1.0.0"
status: "draft"
created: "2026-01-08"
updated: "2026-01-08"
author: "지니"
---

# SPEC-VOICE-001: 인수 조건

## 1. 개요

본 문서는 음성 녹취 기반 증거 분석 시스템의 인수 조건과 테스트 시나리오를 정의한다.

---

## 2. 테스트 시나리오

### 시나리오 1: 녹취 파일 STT 변환

**목적**: 음성 파일이 정확하게 텍스트로 변환되는지 검증

```gherkin
Feature: 음성 파일 STT 변환
  녹취 파일을 업로드하면 시스템이 텍스트로 변환한다

  Scenario: 정상적인 음성 파일 변환
    Given 사용자가 유효한 mp3 형식의 음성 파일을 보유한다
    And 음성 파일의 길이는 5분이다
    And 음성 파일에는 2명의 화자가 포함되어 있다
    When 사용자가 "/api/v1/audio/upload" 엔드포인트로 파일을 업로드한다
    And 시스템이 업로드를 성공적으로 처리한다
    And 사용자가 "/api/v1/audio/{id}/transcribe" 엔드포인트로 STT 변환을 요청한다
    Then 시스템은 200 상태 코드를 반환한다
    And 응답에는 처리 상태가 "processing"으로 포함된다
    And 변환 완료 후 상태가 "completed"로 변경된다
    And 변환된 텍스트에는 타임스탬프가 포함된다
    And 각 세그먼트에는 신뢰도 점수가 포함된다

  Scenario: 지원하지 않는 파일 형식 거부
    Given 사용자가 txt 형식의 파일을 보유한다
    When 사용자가 "/api/v1/audio/upload" 엔드포인트로 파일을 업로드한다
    Then 시스템은 400 상태 코드를 반환한다
    And 응답에는 "지원하지 않는 파일 형식입니다" 메시지가 포함된다

  Scenario: 손상된 음성 파일 처리
    Given 사용자가 손상된 mp3 파일을 보유한다
    When 사용자가 "/api/v1/audio/upload" 엔드포인트로 파일을 업로드한다
    And 시스템이 STT 변환을 시도한다
    Then 시스템은 변환 상태를 "failed"로 설정한다
    And 응답에는 구체적인 오류 메시지가 포함된다
```

---

### 시나리오 2: 원본 보존 무결성 검증

**목적**: 원본 파일이 변조 없이 보존되는지 검증

```gherkin
Feature: 원본 파일 무결성 보존
  업로드된 원본 파일은 불변 상태로 보존된다

  Scenario: 업로드 시 해시 생성 및 검증
    Given 사용자가 "test_recording.wav" 파일을 보유한다
    And 파일의 SHA-256 해시가 "abc123def456..."이다
    When 사용자가 파일을 업로드한다
    Then 시스템은 동일한 SHA-256 해시를 생성하여 저장한다
    And 저장된 해시와 원본 해시가 일치한다
    And 원본 파일은 읽기 전용 저장소에 저장된다

  Scenario: 원본 파일 접근 시도 거부
    Given 파일 ID "file-001"의 원본 파일이 저장되어 있다
    When 사용자가 원본 파일 수정을 시도한다
    Then 시스템은 403 상태 코드를 반환한다
    And 응답에는 "원본 파일은 수정할 수 없습니다" 메시지가 포함된다
    And 감사 로그에 접근 시도가 기록된다

  Scenario: 무결성 검증 실행
    Given 파일 ID "file-001"의 원본 파일이 저장되어 있다
    And 저장된 해시 값이 존재한다
    When 시스템이 무결성 검증을 실행한다
    Then 현재 파일의 해시와 저장된 해시가 일치한다
    And 검증 결과가 감사 로그에 기록된다

  Scenario: 원본 텍스트와 교정본 분리
    Given STT 변환이 완료된 파일이 존재한다
    When 사용자가 "/api/v1/audio/{id}/transcript?version=original" 요청한다
    Then 시스템은 원본 STT 결과를 반환한다
    When 사용자가 "/api/v1/audio/{id}/transcript?version=corrected" 요청한다
    Then 시스템은 교정된 텍스트를 반환한다
    And 두 버전은 서로 독립적으로 관리된다
```

---

### 시나리오 3: 범죄 발언 자동 태깅

**목적**: 협박, 공갈, 사기, 모욕 발언이 정확하게 태깅되는지 검증

```gherkin
Feature: 범죄 발언 자동 태깅
  시스템이 범죄 유형별로 발언을 자동 분류한다

  Scenario: 협박 발언 감지
    Given STT 변환된 텍스트에 "죽여버린다"라는 발언이 포함되어 있다
    And 해당 발언의 화자는 "Speaker A"이다
    And 발언 시간은 "00:02:30"이다
    When 시스템이 범죄 발언 분석을 실행한다
    Then 해당 발언에 "협박" 태그가 부착된다
    And 태그에는 형법 제283조 참조가 포함된다
    And 태그 신뢰도 점수가 0.8 이상이다

  Scenario: 공갈 발언 감지
    Given STT 변환된 텍스트에 "돈 안 주면 퍼뜨려버린다"라는 발언이 포함되어 있다
    When 시스템이 범죄 발언 분석을 실행한다
    Then 해당 발언에 "공갈" 태그가 부착된다
    And 태그에는 형법 제350조 참조가 포함된다

  Scenario: 복합 범죄 발언 감지
    Given STT 변환된 텍스트에 협박과 모욕이 혼합된 발언이 포함되어 있다
    When 시스템이 범죄 발언 분석을 실행한다
    Then 해당 발언에 "협박"과 "모욕" 태그가 모두 부착된다
    And 각 태그에는 개별 신뢰도 점수가 포함된다

  Scenario: 맥락 기반 분석
    Given STT 변환된 텍스트에 "죽인다"라는 단어가 포함되어 있다
    And 해당 발언의 전후 맥락이 농담 또는 비유임이 명확하다
    When 시스템이 범죄 발언 분석을 실행한다
    Then 시스템은 맥락을 고려하여 낮은 신뢰도 점수를 부여한다
    And 해당 발언은 "검토 필요" 상태로 표시된다

  Scenario: 범죄 발언 목록 조회
    Given 분석이 완료된 파일 ID "file-001"이 존재한다
    And 3개의 범죄 발언이 태깅되어 있다
    When 사용자가 "/api/v1/audio/file-001/analysis/crime" 요청한다
    Then 시스템은 3개의 태깅된 발언 목록을 반환한다
    And 각 발언에는 유형, 시간, 화자, 신뢰도가 포함된다
```

---

### 시나리오 4: 가스라이팅 패턴 감지

**목적**: 심리적 조작 패턴이 정확하게 감지되고 그룹화되는지 검증

```gherkin
Feature: 가스라이팅 패턴 감지
  시스템이 가스라이팅 유형별로 발언 패턴을 분석한다

  Scenario: 부정(Denial) 패턴 감지
    Given STT 변환된 텍스트에 다음 발언들이 포함되어 있다:
      | 시간     | 화자      | 발언                           |
      | 00:01:00 | Speaker A | "그런 적 없어"                  |
      | 00:03:00 | Speaker A | "네가 잘못 기억하는 거야"         |
      | 00:05:00 | Speaker A | "내가 언제 그랬어"               |
    When 시스템이 심리 분석을 실행한다
    Then 시스템은 "부정(Denial)" 패턴을 감지한다
    And 3개의 발언이 동일 패턴으로 그룹화된다
    And 패턴 반복 횟수가 3회로 기록된다

  Scenario: 전가(Blame-shifting) 패턴 감지
    Given STT 변환된 텍스트에 "네 때문에 이렇게 됐잖아"라는 발언이 포함되어 있다
    When 시스템이 심리 분석을 실행한다
    Then 시스템은 "전가(Blame-shifting)" 패턴을 감지한다
    And 해당 발언에 패턴 태그가 부착된다

  Scenario: 축소(Minimizing) 패턴 감지
    Given STT 변환된 텍스트에 "별거 아닌데 왜 그래"라는 발언이 포함되어 있다
    When 시스템이 심리 분석을 실행한다
    Then 시스템은 "축소(Minimizing)" 패턴을 감지한다
    And 상대방의 감정 상태가 분석되어 함께 기록된다

  Scenario: 복합 가스라이팅 패턴 분석
    Given 대화에 부정, 전가, 축소 패턴이 모두 포함되어 있다
    When 시스템이 심리 분석을 실행한다
    Then 시스템은 각 패턴을 개별적으로 감지한다
    And 전체 대화의 종합 위험도를 "높음"으로 평가한다
    And 분석 결과에 권고 조치가 포함된다

  Scenario: 심리 분석 결과 조회
    Given 심리 분석이 완료된 파일 ID "file-001"이 존재한다
    When 사용자가 "/api/v1/audio/file-001/analysis/psychology" 요청한다
    Then 시스템은 다음 정보를 반환한다:
      | 항목                  | 내용                    |
      | 가스라이팅 패턴 수     | 4                      |
      | 주요 패턴             | 부정, 전가              |
      | 위험도               | 높음                    |
      | 피해자 감정 변화      | 불안 증가 추세           |
```

---

### 시나리오 5: 증거 보고서 생성

**목적**: 모든 분석 결과가 통합된 법적 증거 보고서가 정확하게 생성되는지 검증

```gherkin
Feature: 증거 보고서 생성
  시스템이 분석 결과를 통합한 PDF 보고서를 생성한다

  Scenario: 보고서 생성 요청
    Given 파일 ID "file-001"의 모든 분석이 완료되었다
    And STT 변환, 화자 분리, 범죄 분석, 심리 분석이 완료되었다
    When 사용자가 "/api/v1/audio/file-001/report" POST 요청한다
    Then 시스템은 202 상태 코드를 반환한다
    And 응답에는 보고서 생성 작업 ID가 포함된다
    And 보고서 생성 상태가 "generating"으로 설정된다

  Scenario: 보고서 다운로드
    Given 보고서 생성이 완료된 파일 ID "file-001"이 존재한다
    When 사용자가 "/api/v1/audio/file-001/report" GET 요청한다
    Then 시스템은 PDF 파일을 반환한다
    And Content-Type 헤더가 "application/pdf"이다
    And 파일명에 날짜와 파일 ID가 포함된다

  Scenario: 보고서 내용 검증
    Given 생성된 보고서 PDF가 존재한다
    Then 보고서에는 다음 섹션이 포함되어 있다:
      | 섹션              | 내용                        |
      | 표지             | 제목, 생성일, 파일 정보       |
      | 원본 정보        | 파일명, 해시값, 녹음 시간      |
      | 전체 녹취록      | 화자별 발언, 타임스탬프       |
      | 범죄 발언 요약   | 유형별 발언 목록, 법조문      |
      | 심리 분석 결과   | 패턴 요약, 위험도 평가        |
      | 타임라인        | 주요 이벤트 시각화            |
      | 부록            | 용어 설명, 분석 방법론        |
    And 보고서에는 페이지 번호가 포함되어 있다
    And 보고서에는 생성 시스템 정보가 포함되어 있다

  Scenario: 불완전한 분석 상태에서 보고서 요청
    Given 파일 ID "file-002"의 STT 변환만 완료되었다
    And 범죄 분석과 심리 분석은 미완료 상태이다
    When 사용자가 "/api/v1/audio/file-002/report" POST 요청한다
    Then 시스템은 400 상태 코드를 반환한다
    And 응답에는 "분석이 완료되지 않았습니다" 메시지가 포함된다
    And 미완료 분석 항목 목록이 포함된다

  Scenario: 보고서 재생성
    Given 파일 ID "file-001"의 보고서가 이미 생성되어 있다
    When 사용자가 "/api/v1/audio/file-001/report" POST 요청한다
    And 요청에 "regenerate: true" 옵션이 포함되어 있다
    Then 시스템은 새로운 버전의 보고서를 생성한다
    And 이전 버전의 보고서는 아카이브된다
    And 새 보고서에는 버전 번호가 증가되어 표시된다
```

---

## 3. 품질 게이트

### 3.1 기능 완성 기준

| 기능 | 완성 기준 | 검증 방법 |
|------|----------|-----------|
| STT 변환 | 한국어 WER < 10% | 표준 데이터셋 평가 |
| 화자 분리 | DER < 15% | pyannote 벤치마크 |
| 범죄 분석 | Precision > 80%, Recall > 75% | 라벨링 데이터셋 |
| 심리 분석 | 전문가 검증 일치율 > 70% | 전문가 리뷰 |
| 보고서 | 법적 형식 준수율 100% | 법률 자문 검토 |

### 3.2 비기능 완성 기준

| 항목 | 기준 | 검증 방법 |
|------|------|-----------|
| 테스트 커버리지 | 85% 이상 | pytest-cov |
| API 응답 시간 | P95 < 2초 | 부하 테스트 |
| 보안 취약점 | OWASP Top 10 없음 | 보안 감사 |
| 가용성 | 99.5% 이상 | 모니터링 |

---

## 4. 정의 완료 (Definition of Done)

### 4.1 각 기능별 완료 기준

기능이 "완료"로 간주되려면 다음 조건을 모두 충족해야 한다:

1. **코드 품질**
   - 단위 테스트 작성 및 통과 (커버리지 85% 이상)
   - 린트 경고 0건 (ruff)
   - 타입 체크 통과 (mypy strict)

2. **기능 검증**
   - 모든 Given-When-Then 시나리오 통과
   - 엣지 케이스 테스트 통과
   - 통합 테스트 통과

3. **문서화**
   - API 문서 업데이트
   - 변경 이력 기록
   - 사용자 가이드 업데이트 (필요시)

4. **보안**
   - 보안 검토 완료
   - 민감 데이터 암호화 확인
   - 인증/인가 검증

5. **코드 리뷰**
   - 최소 1명의 리뷰어 승인
   - 모든 코멘트 해결

---

## 5. 추적성

### 5.1 관련 문서

- `spec.md`: EARS 형식 요구사항
- `plan.md`: 구현 계획 및 마일스톤

### 5.2 태그

```
[SPEC-VOICE-001] [ACCEPTANCE]
```

---

## 6. 변경 이력

| 날짜 | 버전 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 2026-01-08 | 1.0.0 | 지니 | 초안 작성 |
