---
id: SPEC-VOICE-001
document: plan
version: "1.0.0"
status: "draft"
created: "2026-01-08"
updated: "2026-01-08"
author: "지니"
---

# SPEC-VOICE-001: 구현 계획

## 1. 개요

본 문서는 음성 녹취 기반 증거 분석 시스템의 구현 계획을 정의한다.

---

## 2. 구현 단계

### Phase 1: 음성 텍스트 변환 기반 구축

**우선순위**: Primary Goal (최우선)

**범위**:
- 음성 파일 업로드 시스템 구축
- Whisper large-v3 기반 STT 엔진 통합
- FFmpeg를 통한 오디오 전처리 파이프라인
- pyannote-audio 기반 화자 분리 시스템

**구현 항목**:

1. 프로젝트 구조 설정
   - FastAPI 프로젝트 초기화
   - 디렉토리 구조 정의
   - 의존성 관리 (pyproject.toml)

2. 오디오 처리 모듈
   - 파일 업로드 엔드포인트 (`/api/v1/audio/upload`)
   - 파일 형식 검증 (mp3, wav, m4a, flac, ogg)
   - FFmpeg 기반 오디오 정규화
   - SHA-256 해시 생성 및 저장

3. STT 엔진 통합
   - Whisper large-v3 모델 로드
   - 비동기 변환 처리
   - 세그먼트별 타임스탬프 추출
   - 신뢰도 점수 산출

4. 화자 분리 시스템
   - pyannote-audio 모델 설정
   - 화자별 세그먼트 분리
   - 화자 레이블링 (Speaker A, B, ...)
   - STT 결과와 화자 정보 병합

**기술 스택**:
- Whisper large-v3 (OpenAI)
- pyannote-audio 3.1+
- FFmpeg 6.0+
- FastAPI 0.115+
- SQLAlchemy 2.0+ (async)

**테스트 전략**:
- 단위 테스트: 각 모듈별 기능 검증
- 통합 테스트: 업로드-변환-분리 파이프라인
- 성능 테스트: 10분 이상 음성 파일 처리 시간

---

### Phase 2: 증거 관리 시스템

**우선순위**: Secondary Goal

**범위**:
- 원본 파일 불변 보존 시스템
- 원본 텍스트와 교정본 분리 관리
- 감사 로그 시스템
- 암호화 저장소

**구현 항목**:

1. 원본 보존 시스템
   - 원본 파일 읽기 전용 저장소
   - 파일 접근 제한 (시스템 계정만 가능)
   - 정기 무결성 검증 (해시 비교)

2. 버전 관리 시스템
   - 원본 텍스트 저장 (`version: "original"`)
   - 교정본 별도 저장 (`version: "corrected"`)
   - 버전별 변경 이력 추적
   - 비교 뷰 제공 (diff)

3. 감사 로그 시스템
   - 모든 API 요청 로깅
   - 파일 접근 이력 기록
   - 변경 사항 추적
   - 로그 변조 방지 (append-only)

4. 보안 시스템
   - AES-256 암호화 저장
   - TLS 1.3 전송 암호화
   - JWT 기반 인증
   - 역할 기반 접근 제어 (RBAC)

**기술 스택**:
- SQLite (개발) / PostgreSQL 16+ (운영)
- cryptography (Python)
- python-jose (JWT)

**테스트 전략**:
- 보안 테스트: 권한 없는 접근 시도
- 무결성 테스트: 해시 검증
- 감사 테스트: 로그 완전성 검증

---

### Phase 3: 범죄 분석 시스템

**우선순위**: Secondary Goal

**범위**:
- 협박/공갈/사기/모욕 발언 자동 탐지
- 범죄 유형별 태깅 시스템
- 법적 참조 연결
- 신뢰도 점수 산출

**구현 항목**:

1. 키워드 기반 탐지
   - 범죄 유형별 키워드 사전 구축
   - 정규 표현식 패턴 매칭
   - 한국어 형태소 분석 연동

2. LLM 기반 맥락 분석
   - LangChain + Claude API 통합
   - 프롬프트 엔지니어링
   - 맥락 기반 범죄 의도 분석
   - few-shot 예시 구성

3. 태깅 시스템
   - 발언별 범죄 태그 부착
   - 태그 신뢰도 점수
   - 관련 법조문 자동 연결
   - 태그 수정/검토 기능

4. 분석 결과 API
   - 범죄 발언 목록 조회
   - 유형별 필터링
   - 타임라인 뷰

**기술 스택**:
- LangChain 0.3+
- Claude API (Anthropic)
- KoNLPy (한국어 형태소 분석)

**테스트 전략**:
- 정확도 테스트: 라벨링된 데이터셋 기반
- 오탐지 테스트: false positive 비율
- 미탐지 테스트: false negative 비율

---

### Phase 4: 심리 분석 시스템

**우선순위**: Tertiary Goal

**범위**:
- 가스라이팅 패턴 감지
- 감정 분석 (텍스트 기반)
- 심리적 조작 패턴 그룹화
- 위험도 평가

**구현 항목**:

1. 가스라이팅 패턴 분석
   - 부정/전가/축소/혼란 패턴 탐지
   - 패턴별 키워드/구문 사전
   - LLM 기반 맥락 분석
   - 대화 전체에 걸친 패턴 추적

2. 감정 분석
   - 발언별 감정 분류 (분노, 공포, 슬픔, 혐오, 놀람, 행복, 중립)
   - 감정 강도 점수화
   - 시간에 따른 감정 변화 추적
   - 화자별 감정 프로파일

3. 심리 패턴 그룹화
   - 관련 발언 클러스터링
   - 패턴 타임라인 시각화
   - 반복 패턴 감지

4. 위험도 평가
   - 종합 위험도 점수
   - 위험 수준 분류 (낮음/중간/높음/심각)
   - 권고 조치 제안

**기술 스택**:
- LangChain 0.3+
- Claude API
- transformers (감정 분석 모델)

**테스트 전략**:
- 패턴 인식 테스트: 알려진 패턴 데이터셋
- 감정 분석 정확도: 벤치마크 데이터셋
- 전문가 검증: 심리 전문가 리뷰

---

### Phase 5: 보고서 생성 시스템

**우선순위**: Final Goal

**범위**:
- 통합 증거 보고서 생성
- PDF 출력
- 법적 제출용 형식 지원
- 보고서 버전 관리

**구현 항목**:

1. 보고서 템플릿 시스템
   - 법적 증거 보고서 템플릿
   - 섹션별 레이아웃 정의
   - 헤더/푸터/페이지 번호

2. 컨텐츠 생성
   - 분석 결과 요약
   - 주요 증거 하이라이트
   - 타임라인 시각화
   - 통계 차트 생성

3. PDF 생성
   - WeasyPrint 또는 ReportLab 통합
   - 한글 폰트 지원
   - 테이블/차트 렌더링
   - 서명란/날짜 필드

4. 보고서 관리
   - 버전 관리
   - 다운로드 이력 추적
   - 재생성 기능

**기술 스택**:
- WeasyPrint 또는 ReportLab
- Jinja2 (템플릿)
- Matplotlib/Plotly (차트)

**테스트 전략**:
- 렌더링 테스트: 다양한 데이터 조합
- 형식 검증: 법적 요구사항 충족
- 출력 테스트: PDF 무결성

---

## 3. 기술 아키텍처

### 3.1 시스템 구성도

```
[Client]
    |
    v
[API Gateway] - FastAPI
    |
    +---> [Audio Processing]
    |         - FFmpeg
    |         - Whisper
    |         - pyannote
    |
    +---> [Analysis Engine]
    |         - LangChain
    |         - Claude API
    |
    +---> [Storage]
    |         - File Storage (원본)
    |         - Database (메타데이터)
    |
    +---> [Report Generator]
              - Template Engine
              - PDF Renderer
```

### 3.2 데이터 흐름

```
1. 업로드 → 해시 생성 → 원본 저장
2. 전처리 → STT 변환 → 원본 텍스트 저장
3. 화자 분리 → 세그먼트 매핑
4. 범죄 분석 → 태그 생성
5. 심리 분석 → 패턴 추출
6. 보고서 생성 → PDF 출력
```

---

## 4. 의존성

### 4.1 Python 패키지

```toml
[project]
name = "voice-man"
version = "0.1.0"
requires-python = ">=3.11"

dependencies = [
    "fastapi>=0.115.0",
    "uvicorn[standard]>=0.32.0",
    "sqlalchemy[asyncio]>=2.0.0",
    "pydantic>=2.9.0",
    "python-multipart>=0.0.12",
    "openai-whisper>=20240930",
    "pyannote.audio>=3.1.0",
    "langchain>=0.3.0",
    "anthropic>=0.40.0",
    "python-jose[cryptography]>=3.3.0",
    "weasyprint>=62.0",
    "jinja2>=3.1.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.24.0",
    "pytest-cov>=5.0.0",
    "ruff>=0.8.0",
    "mypy>=1.13.0",
]
```

### 4.2 시스템 의존성

- FFmpeg 6.0+
- CUDA Toolkit 12.0+ (GPU 가속)
- PostgreSQL 16+ (운영 환경)

---

## 5. 위험 요소 및 완화 전략

### 5.1 기술적 위험

| 위험 | 영향 | 완화 전략 |
|------|------|-----------|
| STT 정확도 저하 | 분석 품질 저하 | 모델 파인튜닝, 후처리 교정 |
| GPU 메모리 부족 | 처리 실패 | 청크 처리, 모델 최적화 |
| 화자 분리 오류 | 증거 신뢰도 저하 | 수동 검토 기능, 신뢰도 표시 |

### 5.2 비즈니스 위험

| 위험 | 영향 | 완화 전략 |
|------|------|-----------|
| 법적 요구사항 변경 | 재작업 필요 | 모듈화 설계, 법률 자문 |
| 개인정보보호 위반 | 법적 제재 | 암호화, 접근 제어, 감사 |
| 오탐지/미탐지 | 증거 가치 저하 | 신뢰도 표시, 전문가 검토 |

---

## 6. 품질 기준

### 6.1 코드 품질

- 테스트 커버리지: 85% 이상
- 린트 경고: 0
- 타입 체크: mypy strict mode 통과

### 6.2 성능 기준

- STT 변환: 실시간 대비 0.5x 이하 (10분 파일 → 5분 이내)
- API 응답: P95 < 500ms (조회), P95 < 2s (분석)
- 동시 처리: 10개 파일 병렬 처리

### 6.3 보안 기준

- OWASP Top 10 취약점 없음
- 모든 API 인증 필수
- 민감 데이터 암호화 저장

---

## 7. 추적성

### 7.1 관련 문서

- `spec.md`: EARS 형식 요구사항
- `acceptance.md`: 인수 조건 및 테스트 시나리오

### 7.2 태그

```
[SPEC-VOICE-001] [PLAN]
```

---

## 8. 변경 이력

| 날짜 | 버전 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 2026-01-08 | 1.0.0 | 지니 | 초안 작성 |
